rewrite in c
starting with calc_hl
